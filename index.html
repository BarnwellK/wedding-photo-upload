<!-- Full updated HTML with download mode -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ken & Dee's Wedding Gallery</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <!-- Toastify -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <!-- GLightbox -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('https://images.unsplash.com/photo-1636632519127-c6e09af4a3b5?q=80&w=2070&auto=format&fit=crop') no-repeat center center fixed;
      background-size: cover;
      background-color: #fff8f0;
      min-height: 100vh;
    }

    .overlay {
      background: rgba(255, 248, 240, 0.90);
      backdrop-filter: blur(2px);
      min-height: 100vh;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 40px 20px 20px;
      font-family: 'Georgia', serif;
      color: #bfa060;
    }

    header h1 {
      margin: 0;
      font-size: 2.8em;
      letter-spacing: 2px;
    }

    header p {
      margin-top: 10px;
      font-size: 1.2em;
      color: #a88b5b;
    }

    .floating-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      font-size: 32px;
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transition: background 0.3s;
      z-index: 1000;
    }

    .upload-btn {
      background-color: #bfa060;
    }

    .upload-btn:hover {
      background-color: #a88b5b;
    }

    .download-btn {
      bottom: 110px;
      background-color: #6a4f33;
    }

    .download-btn:hover {
      background-color: #4a3926;
    }

    #fileInput {
      display: none;
    }

    #previewContainer {
      margin-top: 40px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }

    .preview-wrapper {
      position: relative;
      animation: fadeIn 0.6s ease forwards;
    }

    .preview-wrapper img {
      width: 180px;
      border-radius: 12px;
      object-fit: cover;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s, border 0.3s;
    }

    .preview-wrapper img:hover {
      transform: scale(1.05);
    }

    .preview-wrapper.selected img {
      border: 4px solid #ffcc00;
      box-shadow: 0 0 10px 2px #ffcc00;
    }

    #confirmDownload {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #333;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 16px;
      z-index: 999;
    }

    #confirmDownload button {
      background: #ffcc00;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      margin-left: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body>
<div class="overlay">
  <header>
    <h1>Ken & Dee's Wedding Gallery</h1>
    <p>Thank you for sharing our beautiful day üíõ</p>
  </header>

  <div id="previewContainer"></div>

  <button id="uploadButton" class="floating-btn upload-btn">+</button>
  <button id="downloadModeButton" class="floating-btn download-btn">‚¨áÔ∏è</button>
  <input id="fileInput" type="file" multiple>
</div>

<div id="confirmDownload">
  <span id="selectionCount">0 selected</span>
  <button id="downloadSelected">Download</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAAOqmYEYPjvoxSogDLHNqMS4CoSXfsrgs",
    authDomain: "ken-and-dee-wedding-photos.firebaseapp.com",
    projectId: "ken-and-dee-wedding-photos",
    storageBucket: "ken-and-dee-wedding-photos.firebasestorage.app",
    messagingSenderId: "1071327540442",
    appId: "1:1071327540442:web:2f611f8804bd1bd95761e3"
  };

  firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();

  const fileInput = document.getElementById('fileInput');
  const uploadButton = document.getElementById('uploadButton');
  const downloadModeButton = document.getElementById('downloadModeButton');
  const previewContainer = document.getElementById('previewContainer');
  const confirmDownload = document.getElementById('confirmDownload');
  const selectionCount = document.getElementById('selectionCount');
  const downloadSelected = document.getElementById('downloadSelected');

  let downloadMode = false;
  const selectedUrls = new Set();

  const lightbox = GLightbox({ loop: true });

  uploadButton.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file && file.size <= 50 * 1024 * 1024) {
      uploadFile(file);
    } else {
      alert("File is too large. 50MB max.");
    }
  });

  async function uploadFile(file) {
    const fileName = Date.now() + '-' + file.name;
    const ref = firebase.storage().ref('wedding-photos/' + fileName);
    const task = ref.put(file);
    task.on('state_changed', null, () => {
      Toastify({ text: "Upload failed", backgroundColor: "#ff5f6d", duration: 3000 }).showToast();
    }, () => {
      task.snapshot.ref.getDownloadURL().then(addPhoto);
      Toastify({ text: "Upload successful!", backgroundColor: "#00b09b", duration: 3000 }).showToast();
    });
  }

  function addPhoto(url) {
    const wrapper = document.createElement('div');
    wrapper.className = 'preview-wrapper';
    wrapper.innerHTML = `
      <a href="${url}" class="glightbox" data-gallery="gallery1">
        <img src="${url}" loading="lazy">
      </a>
    `;
    wrapper.addEventListener('click', e => {
      if (downloadMode) {
        e.preventDefault();
        wrapper.classList.toggle('selected');
        if (wrapper.classList.contains('selected')) {
          selectedUrls.add(url);
        } else {
          selectedUrls.delete(url);
        }
        selectionCount.textContent = `${selectedUrls.size} selected`;
      }
    });
    previewContainer.prepend(wrapper);
    lightbox.reload();
  }

  async function loadPhotos() {
    const ref = firebase.storage().ref('wedding-photos/');
    const result = await ref.listAll();
    const urls = await Promise.all(result.items.map(item => item.getDownloadURL()));
    urls.reverse().forEach(addPhoto);
  }

  loadPhotos();

  downloadModeButton.addEventListener('click', () => {
    downloadMode = !downloadMode;
    document.querySelectorAll('.preview-wrapper').forEach(el => el.classList.remove('selected'));
    selectedUrls.clear();
    confirmDownload.style.display = downloadMode ? 'flex' : 'none';
    selectionCount.textContent = '0 selected';
  });

  downloadSelected.addEventListener('click', () => {
    selectedUrls.forEach(url => {
      const a = document.createElement('a');
      a.href = url;
      a.download = '';
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });
    downloadMode = false;
    confirmDownload.style.display = 'none';
    selectedUrls.clear();
    document.querySelectorAll('.preview-wrapper').forEach(el => el.classList.remove('selected'));
  });
</script>
</body>
</html>
